name: Update Production (tue svn) with Package Changes

on:
  release:
      types: [published]
      branches:
        - master
  workflow_dispatch:

jobs:

  send_to_prod:
    runs-on: ubuntu-latest
    steps:
      - name: "svn checking out prod"
        run: |
            echo "::group::svn checkout from prod"
            svn co --username "${{ github.secrets.SVN_USERNAME }}" --password "${{ github.secrets.SVN_PASSWORD }}" https://svn.win.tue.nl/repos/prom/Packages/ExogenousData/
            echo "::endgroup::"
      - uses: actions/checkout@v3
        with:
          path: "tmp"
      - name: "moving changes into prod dir"
        run: |
          echo "::group::getting git and copying over"
          echo "$(ls)"
          rm -fr tmp/.svn
          rsync -vau tmp/ ExogenousData/Trunk
          rm -fr tmp
          echo "::endgroup::"
      - name: "svn committing to prod"
        run: |
          echo "::group::sending to prod via svn"
          echo "commiting with :: ${{ github.event.release.name }} : ${{ github.event.release.body }}"
          echo "#${{ github.event.release.name }}\n${{ github.event.release.body }}" > commit.txt
          echo "$(ls)"
          cd ExogenousData
          echo "$(ls)"
          svn add --force .
          svn commit -F ../commit.txt "${{ github.event.release.name }} : ${{ github.event.release.body }}" --no-auth-cache --non-interactive  --username "${{ github.secrets.SVN_USERNAME }}" --password "${{ github.secrets.SVN_PASSWORD }}"
          echo "::endgroup::"